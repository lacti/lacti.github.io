<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="lacti">

	<meta name="description" content="concurrency 스터디 03 Aug 2013 concurrency study 오늘 스터디에서 공부한 내용을 간략히 정리해보자. Wiki: ABA problem Simple, Fast, and Practical Non-Blocking and Blocking Concurrent Queue Algorithms context switching과 simultaneously 실행 환형큐의 thread unsafety 문제 volatile/interlocked operation/memory barrier volatile 과 interlocked operation summerlight: volatile과 메모리 배리어 intrusive/non-intrusive Linux kernel LinkedList Boost: Boost.Intrusive Boost: Intrusive and non-intrusive containers InterlockedSList Interlocked Singly Linked Lists Actor model 각 actor 객체에 접근하는 thread는 반드시 하나임을 보장함. context switching 비용을 줄이기 위해 thread 개수를 제한하지만 많은 actor를 다루기 위해 객체별 수행 동기화 기법을 사용한다. Wiki: Actor model 객체별 함수 수행 동기화 out of order execution 컴파일러의 명령어 재배치 수준이 아닌 cpu 내부의 비순차 실행 비순차 실행을 통해 최대 수행 시간의 절감 효과를 얻음 하드웨어적 한계로 비순차..." />

	<meta http-equiv="date" content="Saturday, 03  2013 00:00:00 GMT" />

	<meta name="keywords" content="concurrency,study,-pub" />

	<meta name="robots" content="INDEX,FOLLOW" />
	<title>concurrency 스터디</title>
	<link href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css" rel="stylesheet">
	<link href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css" rel="stylesheet">
	<link href="/css/markdownpad-github.css" rel="stylesheet">
	<link href="/css/syntax.css" rel="stylesheet">
	<link href="/css/blog-post.css" rel="stylesheet">
	<link href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>
	<div id="head">
		<div class="pure-g">
			<div class="pure-u-1 pure-u-md-1-2">
				<a href="/" title="home"><i class="fa fa-home fa-lg"></i></a>
				<a href="/about/" title="about"><i class="fa fa-male fa-lg"></i></a>
				<a href="/archives/" title="archives"><i class="fa fa-file-text-o fa-lg"></i></a>
				<a href="/tags/" title="tags"><i class="fa fa-tags fa-lg"></i></a>
			</div>
			<div class="pure-u-1 pure-u-md-1-2 text-right">
				<a href="https://github.com/lacti" title="github" rel="nofollow"><i class="fa fa-github fa-lg"></i></a>
				<a href="https://twitter.com/lacti" title="twitter" rel="nofollow"><i class="fa fa-twitter fa-lg"></i></a>
				<a href="http://www.slideshare.net/lactrious/presentations" title="slideshare" rel="nofollow"><i class="fa fa-toggle-right fa-lg"></i></a>
				<a href="http://www.linkedin.com/pub/jaeyoung-choi/99/243/861" title="linkedin" rel="nofollow"><i class="fa fa-linkedin fa-lg"></i></a>
				<a href="https://facebook.com/lactrious" title="facebook" rel="nofollow"><i class="fa fa-facebook fa-lg"></i></a>
				<a href="/atom.xml" title="atom" rel="nofollow"><i class="fa fa-rss fa-lg"></i></a>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="pure-g">
			<div class="pure-u-1">
				<h1 class="page-title">concurrency 스터디</h1>
				<p class="page-date">03 Aug 2013</p>
				<p class="page-tags">
				
				
					<code class="tag"><a href="/tags/#concurrency">concurrency</a></code>
				
				
				
					<code class="tag"><a href="/tags/#study">study</a></code>
				
				
				
				
				</p>
				
				<div class="content">
				<p>오늘 스터디에서 공부한 내용을 간략히 정리해보자.</p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/ABA_problem">Wiki: ABA problem</a></li>
<li><a href="http://www.cs.rochester.edu/u/scott/papers/1996_PODC_queues.pdf">Simple, Fast, and Practical Non-Blocking and Blocking Concurrent Queue Algorithms</a></li>
<li><a href="/2011/08/02/context-switching-and-simultaneously/">context switching과 simultaneously 실행</a></li>
<li><a href="/2012/02/23/thread-unsafety-problem-in-circular-queue/">환형큐의 thread unsafety 문제</a></li>
</ul>

<h3>volatile/interlocked operation/memory barrier</h3>

<ul>
<li><a href="/2011/08/02/volatile-interlocked-operation/">volatile 과 interlocked operation</a></li>
<li><a href="http://summerlight-textcube.blogspot.kr/2009/11/volatile%EA%B3%BC-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%B0%B0%EB%A6%AC%EC%96%B4.html">summerlight: volatile과 메모리 배리어</a></li>
</ul>

<h3>intrusive/non-intrusive</h3>

<ul>
<li><a href="http://www.makelinux.net/ldd3/chp-11-sect-5">Linux kernel LinkedList</a></li>
<li><a href="http://www.boost.org/doc/libs/release/doc/html/intrusive.html">Boost: Boost.Intrusive</a></li>
<li><a href="http://www.boost.org/doc/libs/release/doc/html/intrusive/intrusive_vs_nontrusive.html">Boost: Intrusive and non-intrusive containers</a></li>
</ul>

<h3>InterlockedSList</h3>

<ul>
<li><a href="/2011/08/03/interlocked-singly-linked-lists/">Interlocked Singly Linked Lists</a></li>
</ul>

<h3>Actor model</h3>

<p>각 actor 객체에 접근하는 thread는 반드시 하나임을 보장함. context switching 비용을 줄이기 위해 thread 개수를 제한하지만 많은 actor를 다루기 위해 객체별 수행 동기화 기법을 사용한다.</p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Actor_model">Wiki: Actor model</a></li>
<li><a href="/2011/08/11/synchronize-function-execution-in-each-object/">객체별 함수 수행 동기화</a></li>
</ul>

<h3>out of order execution</h3>

<ul>
<li>컴파일러의 명령어 재배치 수준이 아닌 cpu 내부의 비순차 실행</li>
<li>비순차 실행을 통해 최대 수행 시간의 절감 효과를 얻음</li>
<li>하드웨어적 한계로 비순차 실행 명령어 window를 유지 (reservation stations), 그 내부에서 각 operand 준비 완료가 되면 연산 수행</li>
<li>operand 준비 완료 통지 연산량 감소를 port grouping, 결과 순서를 보장해주기 위해 rob를 사용</li>
<li><a href="http://en.wikipedia.org/wiki/Reservation_stations">Wiki: Reservation stations</a></li>
</ul>

<h3>memory consistency model</h3>

<p>우리가 작성한 대로 수행을 보장해준다면(Sequentially-consistent ordering) 프로그램의 흐름을 이해하기가 쉽지만 최적화 가능성이 줄어듬. 이를 완화(relaxed)해주어서 최적화가 잘 되게 해보자. 그런데 intel x86-64는 그런 것 신경 안 써줘도 빠르게 돌아감*(<a href="https://twitter.com/summerlight00" title="summerlight00">summerlight</a>님 수정)*</p>

<ul>
<li><a href="http://www.hpl.hp.com/techreports/Compaq-DEC/WRL-95-7.pdf">WRL-RR: Shared Memory Consistency Models: A Tutorial</a></li>
</ul>

<p>c++11에 memory order로 추가됨.</p>

<ul>
<li><a href="http://en.cppreference.com/w/cpp/atomic/memory_order">Cppref: std::memory_order</a></li>
</ul>

<h3>c++ threading facilities</h3>

<ul>
<li><a href="http://en.wikipedia.org/wiki/C%2B%2B11#Threading_facilities">Wiki: c++ threading facilities</a></li>
</ul>

<p>표준에서 지원하기는 하지만 표준 라이브러리가 어떻게 구현되어있는지 보고 괜찮은지를 판단한 후 사용하자.</p>

<ul>
<li><a href="http://www.slideshare.net/lactrious/synchronizing-concurrent-threads">async, future, promise in c++</a></li>
</ul>

<h3>sync/async programming</h3>

<p>아무튼 async가 흐름 따라가기가 어렵다.</p>

<ul>
<li><a href="/2012/03/18/asynchronous-programming-and-async-await/">asynchronous programming 과 async, await</a></li>
</ul>

<h3>c++11의 lambda</h3>

<ul>
<li><a href="http://ogoons.tistory.com/69">Visual C++10과 C++0x</a></li>
</ul>

<h3>thread safe한 singleton</h3>

<ul>
<li><a href="http://board.poolc.org/generation03/512">PoolC: C++ 싱글턴 (summerlight)</a></li>
</ul>

<p>근데 intel x86-64에서는 memory barrier 안 쳐줘도 문제가 없다-_-; 하지만 c++11부터는 함수 내 static 변수를 반환하는 것만으로도 대충 thread-safe한 singleton이 구현 가능해졌다.</p>

<ul>
<li><a href="http://stackoverflow.com/questions/8102125/is-local-static-variable-initialization-thread-safe-in-c11">Stackoverflow: Is local static variable initialization thread-safe in C++11</a></li>
<li><a href="http://stackoverflow.com/questions/2280630/c-threadsafe-static-constructor">Stackoverflow: c++ threadsafe static constructor</a></li>
</ul>

<h3>기타 windows via c/c++ 내용</h3>

<p>CreateThread, SSDT, Kernel object, CriticalSection, ...</p>

<h3>lock</h3>

<ul>
<li>CAS (InterlockedCompareExchange 사용) 로 쉽게 구현할 수 있다.</li>
<li>reader/writer (shared/exclusive) lock을 사용할 수 있지만 fairness를 잘 고민해야한다.</li>
<li>그냥 lock/unlock 부르지 말고 raii 잘 써서 쓰자.</li>
</ul>

<h3>과제 해법</h3>

<ul>
<li>lock 사용</li>
<li>interlocked-operation 사용</li>
<li>counter(actor)에 대해 message passing 사용</li>
</ul>

				</div>

				<div class="pure-g page-navigator">
					<div class="pure-u-1-2">
					
						<a href="/2013/07/25/write-game-data/" title="게임 데이터 작성하기 1">&laquo; 게임 데이터 작성하기 1</a>
					
					</div>
					<div class="pure-u-1-2 text-right">
					
						<a href="/2013/08/04/implements-thread-safe-counter/" title="thread-safe한 counter 구현">&raquo; thread-safe한 counter 구현</a>
					
					</div>
				</div>

				<!-- the comments -->
				<div id="disqus_container">
					<div id="disqus_thread"></div>
					<script type="text/javascript">
						var disqus_shortname = 'lacti';
						(function() {
							var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
							dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
							(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
						})();
					</script>
					<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
				</div>
			</div>
		</div>

		
		<footer>
			<hr />
			<div id="footer-menu">
				<a href="#top" title="go to top"><i class="fa fa-chevron-up fa-lg"></i></a>
				<div class="mobile-only">
					<a href="/" title="home"><i class="fa fa-home fa-lg"></i></a>
					<a href="/about/" title="about"><i class="fa fa-male fa-lg"></i></a>
					<a href="/archives/" title="archives"><i class="fa fa-file-text-o fa-lg"></i></a>
					<a href="/tags/" title="tags"><i class="fa fa-tags fa-lg"></i></a>
					<a href="https://github.com/lacti" title="github" rel="nofollow"><i class="fa fa-github fa-lg"></i></a>
					<a href="https://twitter.com/lacti" title="twitter" rel="nofollow"><i class="fa fa-twitter fa-lg"></i></a>
					<a href="http://www.slideshare.net/lactrious/presentations" title="slideshare" rel="nofollow"><i class="fa fa-toggle-right fa-lg"></i></a>
					<a href="http://www.linkedin.com/pub/jaeyoung-choi/99/243/861" title="linkedin" rel="nofollow"><i class="fa fa-linkedin fa-lg"></i></a>
					<a href="https://facebook.com/lactrious" title="facebook" rel="nofollow"><i class="fa fa-facebook fa-lg"></i></a>
					<a href="/atom.xml" title="atom"><i class="fa fa-rss fa-lg"></i></a>
				</div>
			</div>
			<p class="text-right">
				<em>© 2008-2015 Jaeyoung Choi</em>
			</p>
		</footer>
	</div>
	<!-- /.container -->
	<!-- ga -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-51932355-1', 'lacti.me');
		ga('send', 'pageview');
	</script>
</body>
</html>
